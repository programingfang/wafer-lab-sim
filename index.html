<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Wafer Lab æ¨¡æ“¬è£½ç¨‹å·¥åŠï¼ˆåšåº¦ç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background:#f7f9fc; margin:0; }
    header { padding:16px 20px; background:#1f2937; color:#fff; }
    h1 { margin:0; font-size:20px; }
    .container { display:flex; gap:16px; padding:16px; flex-wrap:wrap; }
    .panel { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; flex:1; min-width:320px; }
    .tools { max-width:420px; }
    .tool-btn { display:block; width:100%; text-align:left; padding:10px 12px; margin:6px 0;
                border:1px solid #d1d5db; border-radius:10px; background:#f3f4f6; cursor:pointer; }
    .tool-btn:hover { background:#e5e7eb; }
    .row { display:flex; gap:8px; align-items:center; margin:10px 0; }
    label { font-size:14px; }
    select, button { padding:8px 10px; border:1px solid #d1d5db; border-radius:8px; background:#fff; }
    button.primary { background:#2563eb; color:#fff; border-color:#2563eb; }
    canvas { width:100%; max-width:520px; height:360px; border:1px solid #d1d5db; border-radius:12px; background:#ffffff; }
    ul#historyLog { margin:8px 0 0 20px; padding:0; }
    ul#historyLog li { margin:4px 0; }
    .hint { font-size:12px; color:#6b7280; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ§ª Wafer Lab æ¨¡æ“¬è£½ç¨‹å·¥åŠï¼ˆåšåº¦ç‰ˆ / PR è½‰å°èˆ‡éƒ¨åˆ†è•åˆ»ï¼‰</h1>
  </header>

  <div class="container">
    <div class="panel tools">
      <h3>ğŸ”§ è£½ç¨‹å·¥å…·</h3>
      <button class="tool-btn" onclick="applyLayer('Si',   '#9ca3af', 100)">çŸ½æ™¶åœ“ï¼ˆSi, 100 nmï¼‰</button>
      <button class="tool-btn" onclick="applyLayer('SiO2', '#fbbf24', 30)">ç†±æ°§åŒ–ï¼ˆSiOâ‚‚, 30 nmï¼‰</button>
      <button class="tool-btn" onclick="applyLayer('PR',   '#8b5cf6', 100)">å…‰é˜»å¡—ä½ˆï¼ˆPR, 100 nmï¼‰</button>
      <button class="tool-btn" onclick="applyLayer('Al',   '#d1d5db', 100)">é‡‘å±¬åŒ–ï¼ˆAl PVD, 100 nmï¼‰</button>

      <div class="row">
        <label for="maskSelect">å…‰ç½©åœ–å½¢ï¼š</label>
        <select id="maskSelect">
          <option value="none">ç„¡</option>
          <option value="stripe">æ¢ç´‹</option>
          <option value="circle">åœ“å½¢</option>
        </select>
        <button onclick="exposeAndDevelop()" class="primary">æ›å…‰èˆ‡é¡¯å½±</button>
      </div>

      <div class="row">
        <button onclick="etch()" class="tool-btn">è•åˆ»ï¼ˆä¾ PR åœ–å½¢è½‰å°ï¼Œæ·±åº¦=PRåšåº¦ï¼›ç„¡PRå‰‡ç§»é™¤æœ€ä¸Šå±¤ï¼‰</button>
      </div>

      <div class="row">
        <button onclick="stripPR()" class="tool-btn">å»å…‰é˜»ï¼ˆç§»é™¤æœ€ä¸Šå±¤ PRï¼‰</button>
        <button onclick="resetAll()" class="tool-btn">é‡ç½®</button>
      </div>

      <div class="hint">æç¤ºï¼šè«‹å…ˆæ”¾ä¸Šã€ŒçŸ½æ™¶åœ“ã€ï¼Œå†é€²è¡Œæ°§åŒ– / PR / æ›å…‰ / è•åˆ»â€¦</div>

      <h3>ğŸ“ è£½ç¨‹æ­·å²</h3>
      <ul id="historyLog"></ul>
    </div>

    <div class="panel">
      <h3>ğŸ§« å‰–é¢åœ–ï¼ˆåšåº¦ç­‰æ¯”ä¾‹ï¼Œ1 nm = 0.5 pxï¼‰</h3>
      <canvas id="waferCanvas" width="520" height="360"></canvas>
      <div class="hint">æ¯ä¸€å±¤æœƒæ¨™ç¤ºææ–™åç¨±èˆ‡åšåº¦ï¼›æœ‰åœ–å½¢æ™‚ï¼Œæ¢ç´‹/åœ“å½¢å€åŸŸä»£è¡¨å·²é–‹å£ã€‚</div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('waferCanvas');
    const ctx = canvas.getContext('2d');
    const nmToPx = 0.5; // åšåº¦ç¸®æ”¾æ¯”ä¾‹ï¼š1 nm = 0.5 px

    // layer: { name, color, thickness (nm), pattern: 'none'|'stripe'|'circle' }
    const stack = [];
    const historyEl = document.getElementById('historyLog');

    function log(msg) {
      const li = document.createElement('li');
      li.textContent = msg;
      historyEl.appendChild(li);
    }

    function applyLayer(name, color, thicknessNm) {
      stack.push({ name, color, thickness: thicknessNm, pattern: 'none' });
      log(`åŠ å…¥è–„è†œï¼š${name}ï¼ˆ${thicknessNm} nmï¼‰`);
      draw();
    }

    function exposeAndDevelop() {
      if (stack.length === 0) { log('âš ï¸ ç„¡è–„è†œå¯æ›å…‰'); return; }
      const top = stack[stack.length - 1];
      const mask = document.getElementById('maskSelect').value;
      top.pattern = mask;
      log(`æ›å…‰èˆ‡é¡¯å½±ï¼šå¥—ç”¨å…‰ç½©åœ–å½¢ã€Œ${mask}ã€æ–¼ ${top.name}`);
      draw();
    }

    function stripPR() {
      if (stack.length === 0) return;
      const top = stack[stack.length - 1];
      if (top.name !== 'PR') { log('âš ï¸ æœ€ä¸Šå±¤ä¸æ˜¯ PRï¼Œç•¥é'); return; }
      stack.pop();
      log('å»å…‰é˜»ï¼šç§»é™¤æœ€ä¸Šå±¤ PR');
      draw();
    }

    // è•åˆ»é‚è¼¯ï¼š
    // 1) è‹¥é ‚å±¤æœ‰ PR ä¸”å¸¶ patternï¼Œå°‡è©² pattern è½‰å°åˆ°ã€Œä¸‹ä¸€å±¤ã€ä¸¦
    //    ä¾ PR åšåº¦æ¸›å°‘ä¸‹ä¸€å±¤åšåº¦ï¼ˆéƒ¨åˆ†è•åˆ»ï¼Œæœ€å°‘æ¸›ç‚º 0ï¼Œä¸æœƒæ•´å±¤åˆªé™¤ï¼‰ã€‚
    // 2) è‹¥é ‚å±¤ä¸æ˜¯ PR æˆ–æ²’æœ‰ patternï¼Œå‰‡ç§»é™¤æœ€ä¸Šå±¤è–„è†œï¼ˆæ•´å±¤å»é™¤ï¼‰ã€‚
    function etch() {
      if (stack.length === 0) return;

      const top = stack[stack.length - 1];
      const underIdx = stack.length - 2;
      if (top.name === 'PR' && top.pattern && top.pattern !== 'none' && underIdx >= 0) {
        const under = stack[underIdx];
        const etchDepth = Math.min(top.thickness, under.thickness);
        under.thickness = Math.max(0, under.thickness - etchDepth);
        under.pattern = top.pattern; // è¦–è¦ºåŒ–æ¨™ç¤ºè½‰å°åœ–å½¢
        log(`è•åˆ»ï¼šä»¥ PR åœ–å½¢ã€Œ${top.pattern}ã€å° ${under.name} è•åˆ» ${etchDepth} nmï¼ˆéƒ¨åˆ†è•åˆ»ï¼‰`);
      } else {
        stack.pop();
        log('è•åˆ»ï¼šæœªå—ä¿è­·ï¼Œç§»é™¤æœ€ä¸Šå±¤è–„è†œ');
      }
      draw();
    }

    function resetAll() {
      stack.length = 0;
      historyEl.innerHTML = '';
      log('ğŸ”„ é‡ç½®å°ˆæ¡ˆ');
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // å¾åº•é–‹å§‹å †ç–Šå‘ä¸Šç•«
      let currentTopY = canvas.height;

      for (let i = 0; i < stack.length; i++) {
        const L = stack[i];
        const hPx = Math.max(1, L.thickness * nmToPx); // è‡³å°‘ 1px ä»¥ä¾¿å¯è¦–
        currentTopY -= hPx;

        // ç•«åº•å±¤çŸ©å½¢ï¼ˆæ•´å±¤ï¼‰
        ctx.fillStyle = L.color;
        ctx.fillRect(40, currentTopY, 440, hPx);
        ctx.strokeStyle = "#111827";
        ctx.strokeRect(40, currentTopY, 440, hPx);

        // ä¾ pattern è£½ä½œé–‹å£ï¼ˆè¦–è¦ºåŒ–ï¼‰
        if (L.pattern && L.pattern !== 'none') {
          if (L.pattern === 'stripe') {
            for (let x = 40; x < 480; x += 28) {
              ctx.clearRect(x, currentTopY, 14, hPx);
            }
          } else if (L.pattern === 'circle') {
            ctx.save();
            ctx.beginPath();
            const cx = 260; // ä¸­å¿ƒ
            const cy = currentTopY + hPx / 2;
            const r = Math.min(60, hPx); // åŠå¾‘èˆ‡å±¤é«˜ç›¸é—œ
            ctx.arc(cx, cy, r, 0, Math.PI * 2);
            ctx.clip();
            ctx.clearRect(40, currentTopY, 440, hPx);
            ctx.restore();
          }
        }

        // ææ–™åç¨±èˆ‡åšåº¦æ¨™ç¤º
        ctx.fillStyle = "#111827";
        ctx.font = "12px sans-serif";
        ctx.fillText(`${L.name} (${L.thickness} nm)`, 46, currentTopY + Math.min(hPx - 4, 14));
      }
    }

    // åˆå§‹ç•«å¸ƒ
    draw();
  </script>
</body>
</html>
